---
title: "Snowshoe Hares - Bonanza Creek Experimental Project"
author: "Shayan Kaveh"
date: "11/6/2021"
output: html_document
---

## Overview

**Data citation:** Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. <https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14>

## Set Up

```{r setup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align = 'center', out.extra = 'angle = 90')
library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(kableExtra)
library(plotly)
library(ggbeeswarm)
library(effsize)
```

for analysis: assume normality & homosedaciticity 

## Read in data

```{r}
hares <- read_csv(here("data", "bonanza_hares.csv")) %>% 
  # Clean up data to create dates column
  mutate(mdy = mdy(date)) %>% 
  mutate(year = year(mdy)) %>% 
  filter(age == "j") %>% 
  mutate(site = case_when(
    grid == "bonrip" ~ "Bonrip",
    grid == "bonmat" ~ "Bonmat",
    grid == "bonbs" ~ "Bonbs"))

# Make a juvenile hare data set

j_hares <- hares %>% 
  filter(age == "j") %>% 
  mutate(site = case_when(
    grid == "bonrip" ~ "Bonrip",
    grid == "bonmat" ~ "Bonmat",
    grid == "bonbs" ~ "Bonbs")) %>% 
  group_by(year) %>% 
  summarize(count = n())
```

## Annual Juvenile Hair Trap Counts
```{r}
ggplot(data = hares, aes(x = year)) +
  geom_histogram(bins = 15, color = "#8e715f", fill = "#fcefe4") +
  # this is so extra, but my outline color is that of a snowshoe hare when it's brown and the fill color is their fur color in the winter... lol
  scale_x_continuous(breaks = 1999:2012) +
  theme_classic() +
  labs(title = "Juvenile Snowshoe Hare Trap Count By Year",
       x = "Year",
       y = "Number of Hares") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) 
```

## Summarize these statistics

```{r}
j_hares_summary <- j_hares %>% 
  summarize(mean_count = mean(count, na.rm = TRUE),
            median_count = median(count, na.rm = TRUE),
            sd_count = round(sd(count, na.rm = TRUE),1),
            max_count = max(count),
            min_count = min(count))

j_hares_summary %>% 
  kable(col.names = c("Mean Count",
                      "Median Count",
                      "Standard Deviation",
                      "Maximum Count",
                      "Minimum Count"),
        caption = "<center>Table 1. Juvenile Hare Trap Count Statistics<center>",
        digits = 2) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "center")
```

Takeaways:

## Juvenile Hare Weights
Create a finalized data visualization (or visualizations) in which you compare **juvenile hare weights by sex and site (grid)** (ignore other variables). You should include groups where these variables are not recorded (`NA`). Include finalized figure captions below your visualization(s).

Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures.

Note: There are multiple ways to visualize these comparisons. We encourage you to think carefully then make decisions about how to visualize these comparisons, including:

Can I use faceting to simplify the comparisons into manageable pieces?
Am I showing the audience the data, summary statistics, or both?
Have I updated graph labels, headers in facets, etc. to make it as straightforward as possible for viewers?
Have I simplified and finalized my data visualization(s) to include components that are useful for the audience?

```{r}
gender_j_hares <- hares %>% 
  mutate(sex = case_when(
    sex == "m" ~ "Male",
    sex == "f" ~ "Female"))

ggplot(data = gender_j_hares, 
       aes(x = sex, y = weight)) +
  geom_beeswarm(aes(color = sex)) +
  scale_color_manual(values = c("darkseagreen","lightcoral","indianred1")) +
  geom_boxplot(fill = NA, width = 0.2, outlier.color = NA) +
  stat_summary(fun=mean, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  theme_grey() +
  facet_wrap(~site) +
  labs(x = "Sex",
       y = "Weight (g)",
       title = "Distribution of Juvenile Snowshoe Hare Weights by Sex",
       color = "Sex") + # "color = " changes legend title 
  theme(plot.title = element_text(hjust = 0.5),
        legend.key = element_rect(fill = "white"))
```

Juvenile weight comparison (male & female snowshoe hares). Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. In this section, you should include:

A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares, with a table caption (remember, a table caption should be placed *above* the table in your report)
A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test

```{r}
juvenile_hares_summary <- gender_j_hares %>% 
  group_by(sex) %>% 
  summarize(mean = mean(weight, na.rm = TRUE),
            median = median(weight, na.rm = TRUE),
            sd = sd(weight, na.rm = TRUE),
            sample = n(),
            max = max(weight, na.rm = TRUE),
            min = min(weight, na.rm = TRUE))

juvenile_hares_summary %>% 
  kable(col.names = c("Sex",
                      "Mean",
                      "Median",
                      "Standard Deviation",
                      "Sample Size",
                      "Max Weight",
                      "Minimum Weight"),
        caption = "<center>Juvenile Hare Weight (g) Summary<center>",
        digits = 2) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F, position = "center")
```

```{r, include = FALSE}
# Exploratory graphs

ggplot(data = gender_j_hares, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)

ggplot(data = gender_j_hares, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~sex)
```


```{r}
# Cohen D Test
male_juvenile_hares <- gender_j_hares %>% 
  filter(sex == "Male") %>% 
  drop_na(weight) %>% 
  pull(weight) 
  
female_juvenile_hares <- gender_j_hares %>% 
  filter(sex == "Female") %>% 
  drop_na(weight) %>% 
  pull(weight)  
  
sex_t <- t.test(male_juvenile_hares, female_juvenile_hares)

sex_cohen <- cohen.d(female_juvenile_hares, male_juvenile_hares)
```


4. Juvenile Weight & Hind Foot Length

Relationship between juvenile weight & hind foot length. Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

Upon seeing your graph, your “boss” tells you to try out linear regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. Try it out (the only variables you are expected to include here are hind foot length and weight, using data for all juvenile hares in the data, e.g. you are not expected to explore impacts of sex, site, etc.), and check the model diagnostics.

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

```{r}
ggplot(data = gender_j_hares, 
       aes(x = weight, y = hindft)) +
  geom_point(aes(color = sex, pch = sex)) +
  geom_smooth(method = "lm", se = FALSE, color = "gray30") +
  theme_gray() +
  theme(legend.position = c(0.85, 0.2),
        legend.key = element_rect(fill = "white"),
        plot.title = element_text(hjust = 0.5)) +
   scale_color_manual(values = c("goldenrod2","cyan4","coral"), 
                     name = "Hare Sex") +
  scale_shape_manual(values = c(16,17,18), 
                     name = "Hare Sex") +
  labs(x = "Weight (g)",
       y = "Hind Foot (mm)",
       title = "Hind Foot Compared to Weight of Juvenile Hares") 
```

